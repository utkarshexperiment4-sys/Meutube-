<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metube - वीडियो प्लेटफॉर्म</title>
    
    <meta name="theme-color" content="#ff0000">
    <meta name="description" content="Metube - भारत का अपना वीडियो प्लेटफ़ॉर्म">
    <link rel="manifest" href="manifest.json">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap">
    <link rel="stylesheet" href="style.css">
    
    <style>
        .loading-videos {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
            color: #888;
        }
        
        .no-videos {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
    </style>
</head>
<body>

    <div id="loadingScreen" class="loading-screen">
        <div class="loader"></div>
        <h2>Metube शुरू हो रहा है...</h2>
    </div>

    <div id="appContainer" class="app-container" style="display: none;">
        
        <header class="header">
            <div class="header-left">
                <button class="menu-btn" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo" onclick="showPage('homePage')">
                    <div class="logo-icon">M</div>
                    <span class="logo-text">Metube</span>
                </div>
            </div>
            
            <div class="header-center">
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="सर्च करें...">
                    <button class="search-btn" onclick="searchVideos()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>

            <div class="header-right">
                <button class="upload-btn" onclick="showPage('uploadPage')">
                    <i class="fas fa-video"></i>
                    <span>अपलोड</span>
                </button>
                
                <div id="userSection" class="user-section">
                    <button id="loginBtn" class="login-btn">
                        <i class="fas fa-user-circle"></i>
                        <span>लॉगिन</span>
                    </button>
                    <div id="loggedUser" class="logged-user" style="display: none;">
                        <img id="userAvatar" class="user-avatar" src="https://placehold.co/36x36/888/fff?text=U" alt="उपयोगकर्ता">
                    </div>
                </div>
            </div>
        </header>

        <nav id="sidebar" class="sidebar">
            <div class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="showPage('homePage'); return false;">
                    <i class="fas fa-home"></i>
                    <span>होम</span>
                </a>
                <a href="#" class="nav-item" onclick="showPage('trendingPage'); return false;">
                    <i class="fas fa-fire"></i>
                    <span>ट्रेंडिंग</span>
                </a>
                <a href="#" class="nav-item" onclick="showPage('subscriptionsPage'); return false;">
                    <i class="fas fa-bell"></i>
                    <span>सब्सक्रिप्शन</span>
                </a>
                <hr class="divider">
                <span class="category-title">लाइब्रेरी</span>
                <a href="#" class="nav-item" onclick="showPage('historyPage'); return false;">
                    <i class="fas fa-history"></i>
                    <span>इतिहास</span>
                </a>
                <a href="#" class="nav-item" onclick="showPage('watchLaterPage'); return false;">
                    <i class="fas fa-clock"></i>
                    <span>बाद में देखें</span>
                </a>
            </div>
            <footer class="sidebar-footer">
                © 2024 Metube (भारत).
            </footer>
        </nav>

        <main class="main-content">
            
            <section id="homePage" class="page active">
                <div class="page-header">
                    <h2 class="page-title"><i class="fas fa-home"></i> आपके लिए</h2>
                    <div class="filter-buttons">
                        <button class="filter-btn active">सभी</button>
                        <button class="filter-btn">गेमिंग</button>
                        <button class="filter-btn">संगीत</button>
                        <button class="filter-btn">समाचार</button>
                    </div>
                </div>
                <div id="videosGrid" class="videos-grid">
                    <div class="loading-videos">वीडियो लोड हो रहे हैं...</div>
                </div>
            </section>

            <section id="uploadPage" class="page">
                <div class="upload-container">
                    <h2 class="upload-title"><i class="fas fa-upload"></i> अपना वीडियो अपलोड करें</h2>
                    
                    <div id="uploadArea" class="upload-area">
                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                        <p>वीडियो फ़ाइल को यहाँ ड्रैग और ड्रॉप करें</p>
                        <p>या</p>
                        <input type="file" id="fileInput" accept="video/*" style="display: none;">
                        <button class="select-file-btn" id="selectFileBtn">फ़ाइल चुनें</button>
                        <p id="fileNameDisplay" class="upload-info">कोई फ़ाइल नहीं चुनी गई। (अधिकतम 100MB)</p>
                    </div>

                    <div id="uploadDetails" style="display: none;">
                        <form id="uploadForm">
                            <div id="uploadProgress" class="upload-progress">
                                <p class="progress-text" id="progressText">प्रगति: 0%</p>
                                <div class="progress-bar">
                                    <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
                                </div>
                                <p class="upload-speed" id="uploadSpeed">0 KB/s</p>
                            </div>

                            <div class="form-group">
                                <label for="title">शीर्षक (Title)*</label>
                                <input type="text" id="title" required placeholder="वीडियो का आकर्षक शीर्षक डालें">
                            </div>
                            
                            <div class="form-group">
                                <label for="description">विवरण (Description)*</label>
                                <textarea id="description" rows="5" required placeholder="वीडियो के बारे में विस्तार से बताएं"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="category">श्रेणी (Category)*</label>
                                <select id="category" required>
                                    <option value="">श्रेणी चुनें</option>
                                    <option value="gaming">गेमिंग</option>
                                    <option value="music">संगीत</option>
                                    <option value="news">समाचार</option>
                                    <option value="tech">टेक्नोलॉजी</option>
                                    <option value="other">अन्य</option>
                                </select>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="cancel-btn" onclick="showPage('homePage')">रद्द करें</button>
                                <button type="submit" id="uploadSubmitBtn" class="upload-submit-btn">
                                    <i class="fas fa-cloud-upload-alt"></i> अपलोड शुरू करें
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
            
            <section id="playerPage" class="page">
                <h2 class="page-title"><i class="fas fa-play-circle"></i> वीडियो प्लेयर</h2>
                <div id="videoPlayerContainer" class="video-player-container">
                    <video id="mainVideoPlayer" class="main-video-player" controls autoplay></video>
                    <div id="videoMeta" class="video-meta">
                        <h1 id="playerVideoTitle" class="player-video-title">वीडियो शीर्षक</h1>
                        <p id="playerVideoStats" class="player-video-stats">0 दृश्य • 0 सेकंड पहले</p>
                        <div class="channel-details">
                            <img id="playerChannelAvatar" class="channel-avatar" src="https://placehold.co/48x48/ff0000/fff?text=C" alt="चैनल">
                            <div class="channel-info">
                                <p id="playerChannelName" class="channel-name">चैनल का नाम</p>
                                <p class="subscriber-count">10.5K ग्राहक</p>
                            </div>
                            <button class="subscribe-btn">सब्सक्राइब</button>
                        </div>
                        <div id="playerVideoDescription" class="video-description">विवरण...</div>
                    </div>
                </div>
            </section>

            <section id="trendingPage" class="page">
                <h2 class="page-title"><i class="fas fa-fire"></i> ट्रेंडिंग वीडियो</h2>
                <p style="color: #888;">यह पेज अभी बनाया जा रहा है।</p>
            </section>
            <section id="subscriptionsPage" class="page">
                <h2 class="page-title"><i class="fas fa-bell"></i> सब्सक्रिप्शन</h2>
                <p style="color: #888;">यह पेज अभी बनाया जा रहा है।</p>
            </section>
            <section id="historyPage" class="page">
                <h2 class="page-title"><i class="fas fa-history"></i> इतिहास</h2>
                <p style="color: #888;">यह पेज अभी बनाया जा रहा है।</p>
            </section>
            <section id="watchLaterPage" class="page">
                <h2 class="page-title"><i class="fas fa-clock"></i> बाद में देखें</h2>
                <p style="color: #888;">यह पेज अभी बनाया जा रहा है।</p>
            </section>
        
        </main>

        <nav id="bottomNav" class="bottom-nav">
            <a href="#" class="nav-item active" onclick="showPage('homePage'); return false;">
                <i class="fas fa-home"></i>
                <span>होम</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('trendingPage'); return false;">
                <i class="fas fa-fire"></i>
                <span>ट्रेंडिंग</span>
            </a>
            <button class="nav-item upload-nav-btn" onclick="showPage('uploadPage'); return false;">
                <i class="fas fa-plus"></i>
            </button>
            <a href="#" class="nav-item" onclick="showPage('subscriptionsPage'); return false;">
                <i class="fas fa-bell"></i>
                <span>सब्सक्रिप्शन</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('historyPage'); return false;">
                <i class="fas fa-user"></i>
                <span>आप</span>
            </a>
        </nav>
    </div>

    <script type="module">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB7LMSFYn4KkQXgH95hJJOrXIIlZ_lKQ0k",
            authDomain: "metube-33da9.firebaseapp.com",
            projectId: "metube-33da9",
            storageBucket: "metube-33da9.firebasestorage.app",
            messagingSenderId: "619272225238",
            appId: "1:619272225238:web:e5f22447330dbb7584e477",
            measurementId: "G-B6B7V6T08Z"
        };

        // Import Firebase core and Auth modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // Firestore initialization के लिए केवल getFirestore Import करें
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Import app functions
        import { initMetubeApp, showPage, toggleSidebar, searchVideos } from './app.js';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        // Firestore service को DB_SERVICE के लिए सेट करें
        const db = getFirestore(app); 

        // Global exports for HTML onclick events
        window.showPage = showPage;
        window.toggleSidebar = toggleSidebar;
        window.searchVideos = searchVideos;

        // Sign in anonymously on load
        window.onload = async () => {
            const loadingScreen = document.getElementById('loadingScreen');
            const appContainer = document.getElementById('appContainer');
            
            try {
                await signInAnonymously(auth);
                console.log("Signed in anonymously");
                
                // initMetubeApp को db (Firestore service) पास करें
                initMetubeApp('metube-app-id', auth, db, null); 
                
                // Hide loading screen
                loadingScreen.style.display = 'none';
                appContainer.style.display = 'grid';
                showPage('homePage');
                
            } catch (error) {
                console.error("Error during initialization:", error);
                loadingScreen.innerHTML = `
                    <div style="text-align: center; color: #ff4444;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h2>त्रुटि: ऐप लोड नहीं हो पाया</h2>
                        <p>${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #ff0000; color: white; border: none; border-radius: 5px;">
                            पुनः प्रयास करें
                        </button>
                    </div>
                `;
            }
        };
        
        // ✅ app.js को एक अलग मॉड्यूल के रूप में लोड किया जाना चाहिए। (यह सुनिश्चित करता है कि app.js में Imports काम करते हैं)
                // ✅ app.js को एक अलग मॉड्यूल के रूप में लोड किया जाना चाहिए। (यह सुनिश्चित करता है कि app.js में Imports काम करते हैं)
    </script>
    
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-B6B7V6T08Z"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          // आपकी Measurement ID: G-B6B7V6T08Z
          gtag('config', 'G-B6B7V6T08Z');
    </script>
    </body>
</html>
